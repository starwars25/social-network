<% provide(:title, "#{@user.username}'s profile") %>
<div class="row">
  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12"><h1><%= @user.username %></h1>

    <h2><%= @user.email %></h2>
    <%= image_tag @user.avatar.url, class: 'img-responsive img-thumbnail' if @user.avatar? %>
    <% unless @current_user.has_dialog_with(@user) %>
        <%= link_to 'Send message', dialogs_path(from: @current_user.id, to: @user.id), method: :post %>
    <% end %>
    <% if @current_user.is_friend? @user %>
        <p>This user is a friend of you.</p>
    <% else %>
        <% if FriendRequest.requested? @current_user, @user %>
            <p>You have already sent frienship request.</p>
        <% else %>
            <%= form_for FriendRequest.new do |f| %>
                <%= hidden_field_tag :from_id, @current_user.id %>
                <%= hidden_field_tag :to_id, @user.id %>
                <%= f.submit 'Add friend', class: 'btn btn-primary' %>
            <% end %>
        <% end %>
    <% end %></div>
</div>
<div class="row">
  <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3">
    <% if @user.friends.any? %>
        <h1>Friends</h1>
        <% @user.friends.each do |friend| %>
            <ul class="list-unstyled"><li><%= link_to friend.username, friend %></li>
            <li><%= friend.email %></li>
            <li><%= image_tag friend.avatar.url, class: 'img-responsive img-thumbnail' if friend.avatar? %></li></ul>

        <% end %>
    <% else %>
        <h1>This user has no friends.</h1>
    <% end %></div>
  <div class="col-xs-9 col-sm-9 col-md-9 col-lg-9"><h1>The Wall</h1>
    <h6>We don't need no education...</h6>

    <div id="wall"><%= render @user.wall %></div>
    <%= render 'shared/post_form' %></div>
</div>

<%= subscribe_to "/wall/#{@user.id}" %>
<script>
    PrivatePub.subscribe('/wall/<%= @user.id %>', function (data, channel) {
        $('#wall').prepend(form_input(data));
    });
    var form_input;

    form_input = function (data) {
        var output;
        return output = "<div class=\"post\"><p><strong>" + data.post.from + "</strong></p><p>" + data.post.content + "</p><img src=\"" + data.post.image + "\" class=\"img-responsive img-thumbnail post_image\" /><hr></div>";
    };
    $('#post_content').keypress(function (e) {
        if (e.which === 13) {
            return $('#new_post').submit();
        }
    });
</script>